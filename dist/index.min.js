(function(){function t(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}var e,n,r;e=function(t,e){return null==e&&(e=[]),function(){return 2===e.s?Promise.resolve():1===e.s?new Promise(function(t,n){return e.push({res:t,rej:n})}):Promise.resolve(e.s=1).then(function(){return t()}).then(function(){return e.s=2,e.splice(0).map(function(t){return t.res()})}).catch(function(t){return e.s=0,e.splice(0).map(function(e){return e.rej(t)}),Promise.reject(t)})}},n={"zh-TW":{Category:"分類",Subset:"子集",Name:"名稱",Upload:"上傳",or:"或",Cancel:"取消"}},(r=function(t){var n=this;return null==t&&(t={}),this._url={meta:t.meta,links:t.links},this.root="string"==typeof t.root?document.querySelector(t.root):t.root,this._initRender=null!=t.initRender&&t.initRender,this.evtHandler={},this.ldld=new ldloader({container:this.root,autoZ:!0,className:"ldld full"}),this.i18n=t.i18n||{t:function(t){return t}},this.init=e(function(){return n._init()}),this}).prototype=t(Object.create(Object.prototype),{on:function(t,e){var n=this;return(Array.isArray(t)?t:[t]).map(function(t){var r;return((r=n.evtHandler)[t]||(r[t]=[])).push(e)})},fire:function(t){var e,n,r,o,i,a,u,l=[];for(n=[],r=1,o=arguments.length;r<o;++r)n.push(arguments[r]);for(e=n,r=0,a=(i=this.evtHandler[t]||[]).length;r<a;++r)u=i[r],l.push(u.apply(this,e));return l},load:function(t){var e,n,r,o,i,a;return e="number"==typeof t?this.meta.family[t]:t,n=e.fonts[0],(r=n.xfont)?Promise.resolve(r):(o=this.meta.index.style[n.s],i=this.meta.index.weight[n.w],a=this._url.links+"/"+e.n+"/"+o+"/"+i+(n.x?"":".ttf"),xfl.load({path:a,name:e.n}).then(function(t){return n.xfont=t}))},render:function(){var t,e=this;return this.ldld.on(),t=function(){return e.view.render(),e.ldld.off(),e._rendered=!0},this._rendered?t():setTimeout(function(){return t()},50)},_init:function(){var e=this;return new Promise(function(t,n){var r;return(r=new XMLHttpRequest).addEventListener("readystatechange",function(){var o;if(4===r.readyState){if(200!==r.status)return n(r.responseText);try{e.meta=JSON.parse(r.responseText)}catch(t){return o=t,n(o)}return t()}}),r.open("GET",e._url.meta+"/meta.json"),r.onerror=function(t){return n(t)},r.send()}).then(function(){var r,o,i;if(e.cfg={},e.i18n.addResourceBundle){for(r in o=n)i=o[r],e.i18n.addResourceBundle(r,"@plotdb/choose",i,!0,!0);Array.from(e.root.querySelectorAll("[t]")).map(function(t){return t.textContent=e.i18n.t("@plotdb/choose:"+t.textContent)})}return e.view=new ldview({initRender:e._initRender,root:e.root,action:{click:{cancel:function(){return e.fire("choose",null)}}},handler:{"cur-subset":function(t){var n;return n=t.node,n.textContent=e.cfg.subset||"all",n.classList.toggle("active",!(!e.cfg.subset||"all"===e.cfg.subset))},"cur-cat":function(t){var n;return n=t.node,n.textContent=e.cfg.category||"all",n.classList.toggle("active",!(!e.cfg.category||"all"===e.cfg.category))},category:{list:function(){return["all"].concat(e.meta.index.category)},action:{click:function(t){var n;return t.node,n=t.data,e.cfg.category=n,e.view.render(["font","cur-cat","category"])}},handler:function(t){var n,r;return n=t.node,r=t.data,n.textContent=r,n.classList.toggle("active",e.cfg.category===r||!e.cfg.category&&"all"===r)}},subset:{list:function(){return["all"].concat(e.meta.index.subset)},action:{click:function(t){var n;return t.node,n=t.data,e.cfg.subset=n,e.view.render(["font","cur-subset","subset"])}},handler:function(t){var n,r;return n=t.node,r=t.data,n.textContent=r,n.classList.toggle("active",e.cfg.subset===r||!e.cfg.subset&&"all"===r)}},"font-list":function(t){var n,r;return n=t.node,r=e.meta.dim.width,n.style.gridTemplateColumns="repeat(auto-fill,"+r+"px)"},font:{list:function(){return e.meta.family},host:"undefined"!=typeof vscroll&&null!==vscroll?vscroll.fixed:void 0,key:function(t){return t.n},action:{click:function(t){var n;return t.node,n=t.data,t.idx,e.ldld.on(),e.fire("load.start"),e.load(n).finally(function(){return e.fire("load.end"),e.ldld.off()}).then(function(t){return e.fire("choose",t)}).catch(function(t){return console.error("[@xlfont/choose] font load failed: ",t),e.fire("load.fail",t)})}},handler:function(t){var n,r,o,i,a,u;return n=t.node,r=t.data,o=t.idx,i=[e.cfg.category,e.cfg.subset,e.meta.index],a=i[0],u=i[1],o=i[2],n.classList.toggle("d-none",!(!a||"all"===a||o.category.indexOf(a)===r.c)||!(!u||"all"===u||function(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}(o.subset.indexOf(u),r.s)))},init:function(n){var r,o,i,a,u,l,c,s,d;return r=n.node,o=n.data,i=n.idx,a=i%e.meta.dim.col,u=Math.floor(i/e.meta.dim.col),l=e.meta.dim.padding,c=e.meta.dim.width,s=e.meta.dim.height,d=r.querySelector("[ld=name]"),t(r.style,{width:c+"px",height:s+"px",backgroundImage:"url("+e._url.meta+"/sprite.min.png)",backgroundPosition:-(c+l)*a+"px "+-(s+l)*u+"px"}),d.textContent=o.n}}}})})}}),"undefined"!=typeof module&&null!==module?module.exports=r:"undefined"!=typeof window&&null!==window&&(window.xfc=r)}).call(this);
