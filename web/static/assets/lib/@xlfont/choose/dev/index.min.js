!function(){var n,r,t;function c(t,e){var n,r={}.hasOwnProperty;for(n in e)r.call(e,n)&&(t[n]=e[n]);return t}n=function(t,n){return null==n&&(n=[]),function(){return 2===n.s?Promise.resolve():1===n.s?new Promise(function(t,e){return n.push({res:t,rej:e})}):Promise.resolve(n.s=1).then(function(){return t()}).then(function(){return n.s=2,n.splice(0).map(function(t){return t.res()})}).catch(function(e){return n.s=0,n.splice(0).map(function(t){return t.rej(e)}),Promise.reject(e)})}},r={"zh-TW":{Category:"分類",Subset:"子集",Name:"名稱",Upload:"上傳",or:"或",Cancel:"取消"}},(t=function(t){var e=this;return this._url={meta:(t=null==t?{}:t).meta,links:t.links},this.root="string"==typeof t.root?document.querySelector(t.root):t.root,this._initRender=null!=t.initRender&&t.initRender,this.evtHandler={},this.ldld=new ldloader({container:this.root,autoZ:!0,className:"ldld full"}),this.i18n=t.i18n||{t:function(t){return t}},this.init=n(function(){return e._init()}),this}).prototype=c(Object.create(Object.prototype),{on:function(t,n){var r=this;return(Array.isArray(t)?t:[t]).map(function(t){var e;return((e=r.evtHandler)[t]||(e[t]=[])).push(n)})},fire:function(t){for(var e,n,r,o,i=[],a=[],u=1,l=arguments.length;u<l;++u)a.push(arguments[u]);for(e=a,u=0,r=(n=this.evtHandler[t]||[]).length;u<r;++u)o=n[u],i.push(o.apply(this,e));return i},load:function(t){var e,n="number"==typeof t?this.meta.family[t]:t,r=n.fonts[0];return(e=r.xfont)?Promise.resolve(e):(t=this.meta.index.style[r.s],e=this.meta.index.weight[r.w],e=this._url.links+"/"+n.n+"/"+t+"/"+e+(r.x?"":".ttf"),xfl.load({path:e,name:n.n}).then(function(t){return r.xfont=t}))},render:function(){var t,e=this;return this.ldld.on(),t=function(){return e.view.render(),e.ldld.off(),e._rendered=!0},this._rendered?t():setTimeout(t,50)},_init:function(){var l=this;return new Promise(function(t,e){var n=new XMLHttpRequest;return n.addEventListener("readystatechange",function(){if(4===n.readyState){if(200!==n.status)return e(n.responseText);try{l.meta=JSON.parse(n.responseText)}catch(t){return e(t)}return t()}}),n.open("GET",l._url.meta+"/meta.json"),n.onerror=function(t){return e(t)},n.send()}).then(function(){var t,e;if(l.cfg={},l.i18n.addResourceBundle){for(t in e=r)l.i18n.addResourceBundle(t,"@plotdb/choose",e[t],!0,!0);Array.from(l.root.querySelectorAll("[t]")).map(function(t){return t.textContent=l.i18n.t("@plotdb/choose:"+t.textContent)})}return l.view=new ldview({initRender:l._initRender,root:l.root,action:{click:{cancel:function(){return l.fire("choose",null)}}},handler:{"cur-subset":function(t){t=t.node;return t.textContent=l.cfg.subset||"all",t.classList.toggle("active",!(!l.cfg.subset||"all"===l.cfg.subset))},"cur-cat":function(t){t=t.node;return t.textContent=l.cfg.category||"all",t.classList.toggle("active",!(!l.cfg.category||"all"===l.cfg.category))},category:{list:function(){return["all"].concat(l.meta.index.category)},action:{click:function(t){t.node;t=t.data;return l.cfg.category=t,l.view.render(["font","cur-cat","category"])}},handler:function(t){var e=t.node,t=t.data;return e.textContent=t,e.classList.toggle("active",l.cfg.category===t||!l.cfg.category&&"all"===t)}},subset:{list:function(){return["all"].concat(l.meta.index.subset)},action:{click:function(t){t.node;t=t.data;return l.cfg.subset=t,l.view.render(["font","cur-subset","subset"])}},handler:function(t){var e=t.node,t=t.data;return e.textContent=t,e.classList.toggle("active",l.cfg.subset===t||!l.cfg.subset&&"all"===t)}},"font-list":function(t){var e=t.node,t=l.meta.dim.width;return e.style.gridTemplateColumns="repeat(auto-fill,"+t+"px)"},font:{list:function(){return l.meta.family},host:"undefined"!=typeof vscroll&&null!==vscroll?vscroll.fixed:void 0,key:function(t){return t.n},action:{click:function(t){t.node;var e=t.data;t.idx;return l.ldld.on(),l.fire("load.start"),l.load(e).finally(function(){return l.fire("load.end"),l.ldld.off()}).then(function(t){return l.fire("choose",t)}).catch(function(t){return console.error("[@xlfont/choose] font load failed: ",t),l.fire("load.fail",t)})}},handler:function(t){var e=t.node,n=t.data,r=t.idx,o=[l.cfg.category,l.cfg.subset,l.meta.index],i=o[0],t=o[1];return r=o[2],e.classList.toggle("d-none",!(!i||"all"===i||r.category.indexOf(i)===n.c)||!(!t||"all"===t||function(t,e){var n=-1,r=e.length>>>0;for(;++n<r;)if(t===e[n])return!0;return!1}(r.subset.indexOf(t),n.s)))},init:function(t){var e=t.node,n=t.data,r=t.idx,o=r%l.meta.dim.col,i=Math.floor(r/l.meta.dim.col),a=l.meta.dim.padding,u=l.meta.dim.width,t=l.meta.dim.height,r=e.querySelector("[ld=name]");return c(e.style,{width:u+"px",height:t+"px",backgroundImage:"url("+l._url.meta+"/sprite.min.png)",backgroundPosition:-(u+a)*o+"px "+-(t+a)*i+"px"}),r.textContent=n.n}}}})})}}),"undefined"!=typeof module&&null!==module?module.exports=t:"undefined"!=typeof window&&null!==window&&(window.xfc=t)}.call(this);
