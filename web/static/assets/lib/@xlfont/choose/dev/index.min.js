!function(){var n,r,o;function c(t,e){var n,r={}.hasOwnProperty;for(n in e)r.call(e,n)&&(t[n]=e[n]);return t}n=function(t,n){return null==n&&(n=[]),function(){return 2===n.s?Promise.resolve():1===n.s?new Promise(function(t,e){return n.push({res:t,rej:e})}):Promise.resolve(n.s=1).then(function(){return t()}).then(function(){return n.s=2,n.splice(0).map(function(t){return t.res()})}).catch(function(e){return n.s=0,n.splice(0).map(function(t){return t.rej(e)}),Promise.reject(e)})}},r={"zh-TW":{Category:"分類",Subset:"子集",Name:"名稱",Upload:"上傳",or:"或",Cancel:"取消"}},(o=function(t){var e=this;return this._url={meta:(t=null==t?{}:t).meta,links:t.links},["meta","links"].map(function(t){if(!e._url[t]&&o._url[t])return e._url[t]=o._url[t]}),this.root="string"==typeof t.root?document.querySelector(t.root):t.root,this._initRender=null!=t.initRender&&t.initRender,this.evtHandler={},this.root&&(this.ldld=new ldloader({container:this.root,autoZ:!0,className:"ldld full"})),this.i18n=t.i18n||{t:function(t){return t}},this.init=n(function(){return e._init()}),this}).url=function(t){return null==t&&(t={}),arguments.length?c(o._url||(o._url={}),t):o._url||{}},o.prototype=c(Object.create(Object.prototype),{on:function(t,n){var r=this;return(Array.isArray(t)?t:[t]).map(function(t){var e;return((e=r.evtHandler)[t]||(e[t]=[])).push(n)})},fire:function(t){for(var e,n,r,o,i=[],u=[],a=1,l=arguments.length;a<l;++a)u.push(arguments[a]);for(e=u,a=0,r=(n=this.evtHandler[t]||[]).length;a<r;++a)o=n[a],i.push(o.apply(this,e));return i},load:function(o){var i=this;return this.init().then(function(){var t,e,n,r;return o?(t="number"==typeof o?i.meta.family[o]:"string"==typeof o?i.meta.family.filter(function(t){return t.n.toLowerCase()===o.toLowerCase()})[0]:o.name?i.meta.family.filter(function(t){return t.n.toLowerCase()===o.name.toLowerCase()})[0]:o)?(r=(e=t.fonts[0]).xfont)?Promise.resolve(r):(r=i.meta.index.style[e.s],n=i.meta.index.weight[e.w],r=i._url.links+"/"+t.n+"/"+r+"/"+n+(e.x?"":".ttf"),xfl.load({path:r,name:t.n}).then(function(t){return e.xfont=t})):Promise.reject(((n=new Error).message="font not found",n.id=404,n)):null})},render:function(){var t,e=this;return this.ldld.on(),t=function(){return e.view.render(),e.ldld.off(),e._rendered=!0},this._rendered?t():setTimeout(t,50)},_init:function(){var l=this;return new Promise(function(t,e){var n=new XMLHttpRequest;return n.addEventListener("readystatechange",function(){if(4===n.readyState){if(200!==n.status)return e(n.responseText);try{l.meta=JSON.parse(n.responseText)}catch(t){return e(t)}return t()}}),n.open("GET",l._url.meta+"/meta.json"),n.onerror=function(t){return e(t)},n.send()}).then(function(){var t,e;if(l.root){if(l.cfg={},l.i18n.addResourceBundle){for(t in e=r)l.i18n.addResourceBundle(t,"@plotdb/choose",e[t],!0,!0);Array.from(l.root.querySelectorAll("[t]")).map(function(t){return t.textContent=l.i18n.t("@plotdb/choose:"+t.textContent)})}return l.view=new ldview({initRender:l._initRender,root:l.root,action:{input:{search:function(t){t=t.node;return l.cfg.keyword=t.value||"",console.log(">>>"),l.view.render(["font"])}},click:{cancel:function(){return l.fire("choose",null)}}},init:{"cur-subset":function(t){t=t.node;if("undefined"!=typeof BSN&&null!==BSN)return new BSN.Dropdown(t)},"cur-cat":function(t){t=t.node;if("undefined"!=typeof BSN&&null!==BSN)return new BSN.Dropdown(t)}},handler:{"cur-subset":function(t){t=t.node;return t.textContent=l.cfg.subset||"all",t.classList.toggle("active",!(!l.cfg.subset||"all"===l.cfg.subset))},"cur-cat":function(t){t=t.node;return t.textContent=l.cfg.category||"all",t.classList.toggle("active",!(!l.cfg.category||"all"===l.cfg.category))},category:{list:function(){return["all"].concat(l.meta.index.category)},action:{click:function(t){t.node;t=t.data;return l.cfg.category=t,l.view.render(["font","cur-cat","category"])}},handler:function(t){var e=t.node,t=t.data;return e.textContent=t,e.classList.toggle("active",l.cfg.category===t||!l.cfg.category&&"all"===t)}},subset:{list:function(){return["all"].concat(l.meta.index.subset)},action:{click:function(t){t.node;t=t.data;return l.cfg.subset=t,l.view.render(["font","cur-subset","subset"])}},handler:function(t){var e=t.node,t=t.data;return e.textContent=t,e.classList.toggle("active",l.cfg.subset===t||!l.cfg.subset&&"all"===t)}},"font-list":function(t){var t=t.node,e=l.meta.dim.width;return t.style.gridTemplateColumns="repeat(auto-fill,"+e+"px)"},font:{list:function(){return l.meta.family},host:"undefined"!=typeof vscroll&&null!==vscroll?vscroll.fixed:void 0,key:function(t){return t.n},action:{click:function(t){t.node;var e=t.data;t.idx;return l.ldld.on(),l.fire("load.start"),l.load(e).finally(function(){return l.fire("load.end"),l.ldld.off()}).then(function(t){return l.fire("choose",t)}).catch(function(t){return console.error("[@xlfont/choose] font load failed: ",t),l.fire("load.fail",t)})}},handler:function(t){var e=t.node,n=t.data,t=t.idx,r=[l.cfg.keyword,l.cfg.category,l.cfg.subset,l.meta.index],o=r[0],i=r[1],u=r[2];return t=r[3],e.classList.toggle("d-none",o&&!~(n.n+n.d).toLowerCase().indexOf(o.toLowerCase())||!(!i||"all"===i||t.category.indexOf(i)===n.c)||!(!u||"all"===u||function(t,e){var n=-1,r=e.length>>>0;for(;++n<r;)if(t===e[n])return 1;return}(t.subset.indexOf(u),n.s)))},init:function(t){var e=t.node,n=t.data,t=t.idx,r=t%l.meta.dim.col,t=Math.floor(t/l.meta.dim.col),o=l.meta.dim.padding,i=l.meta.dim.width,u=l.meta.dim.height,a=e.querySelector("[ld=name]");return c(e.style,{width:i+"px",height:u+"px",backgroundImage:"url("+l._url.meta+"/sprite.min.png)",backgroundPosition:-(i+o)*r+"px "+-(u+o)*t+"px"}),a.textContent=n.n}}}})}})}}),"undefined"!=typeof module&&null!==module?module.exports=o:"undefined"!=typeof window&&null!==window&&(window.xfc=o)}.call(this);
